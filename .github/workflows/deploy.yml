name: Deploy to single host in oracle cloud
on: [push]
uses: mickvav/biotools/.github/workflows/tests.yml@master
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Do ssh magic
        env:
          secrets_private_key: ${{secrets.PRIVATE_KEY}}
          secrets_username: ${{secrets.USERNAME}}
          secrets_hostname: ${{secrets.HOSTNAME}}
        run: | 
          echo "$secrets_private_key" > identity
          echo "::warning:: Going to oc2"
          ssh -i identity $secrets_username@$secrets_hostname "rm -rf biotools.bak; mv biotools biotools.bak; git clone git@github.com:mickvav/biotools.git"
      - uses: webiny/action-post-run@2.0.1
        id: post-run-command
        with:
          run: rm identity

